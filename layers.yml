- name: power
  layers:
    - name: line
      query: "SELECT osm_id AS gid, ST_AsBinary(geometry) AS geom, tunnel, location, frequency, type, name, line,
                      ref, char_length(ref) AS ref_len,
                      convert_voltage(voltage) / 1000 AS voltage, operator
              FROM osm_power_lines
              WHERE geometry && !BBOX!"
      geometry: linestring
    - name: tower
      query: "SELECT osm_id AS gid, ST_AsBinary(geometry) AS geom, type, name, ref, operator
              FROM osm_power_tower
              WHERE geometry && !BBOX!"
      geometry: point
    - name: substation
      query: "SELECT osm_id AS gid, ST_AsBinary(geometry) AS geom, name,
              convert_voltage(voltage) / 1000 AS voltage, substation, operator
              FROM substation
              WHERE geometry && !BBOX!"
      geometry: linestring
    - name: substation_point
      query: "SELECT osm_id AS gid, ST_AsBinary(ST_Centroid(geometry)) AS geom, name,
              convert_voltage(voltage) / 1000 AS voltage,
              substation
              FROM substation
              WHERE geometry && !BBOX!
              "
      geometry: point
    - name: plant
      query: "SELECT osm_id AS gid, ST_AsBinary(geometry) AS geom, name, operator,
              convert_power(output)/1e6 AS output, source,
              plant_label(name, output, source) AS label
              FROM power_plant
              WHERE geometry && !BBOX!"
      geometry: linestring
    - name: plant_point
      query: "SELECT osm_id AS gid, ST_AsBinary(ST_Centroid(geometry)) AS geom, name,
              convert_power(output)/1e6 AS output, source,
              plant_label(name, output, source) AS label
              FROM power_plant
              WHERE geometry && !BBOX!
              "
      geometry: point
    - name: generator
      query: "SELECT osm_id AS gid, ST_AsBinary(ST_Centroid(geometry)) AS geom, name, operator,
              convert_power(output)/1e3 AS output, source, type, ref
              FROM osm_power_generator
              WHERE geometry && !BBOX!"
      geometry: geometry
    - name: transformer
      query: "SELECT osm_id AS gid, ST_AsBinary(ST_Centroid(geometry)) AS geom, name
              FROM osm_power_switchgear
              WHERE type = 'transformer'
              AND geometry && !BBOX!"
      geometry: point
- name: telecoms
  layers:
    - name: communication_line
      query: "SELECT osm_id AS gid, ST_AsBinary(geometry) AS geom, operator, name, location
              FROM osm_comms_cable
              WHERE geometry && !BBOX!"
      geometry: linestring
    - name: data_center
      query: "SELECT osm_id AS gid, ST_AsBinary(geometry) AS geom, operator, name, ref
              FROM osm_data_center
              WHERE geometry && !BBOX!"
      geometry: linestring
    - name: mast
      query: "SELECT osm_id AS gid, ST_AsBinary(geometry) AS geom, operator, name, ref
              FROM osm_mast
              WHERE (type = 'communications_tower'
                     OR tower_type IN ('communication', 'radio', 'antenna'))
              AND geometry && !BBOX!
              "
      geometry: point
- name: petroleum
  layers:
    - name: pipeline
      query: "SELECT osm_id AS gid, ST_AsBinary(geometry) AS geom, operator, name, location
              FROM osm_pipeline
              WHERE (substance IN ('natural_gas', 'gas', 'oil', 'fuel', 'cng')
                   OR type IN ('natural_gas', 'gas', 'oil', 'fuel', 'cng'))
              AND geometry && !BBOX!"
      geometry: linestring
    - name: well
      query: "SELECT osm_id AS gid, ST_AsBinary(geometry) AS geom, operator, name
              FROM osm_petroleum_well
              WHERE geometry && !BBOX!"
      geometry: point
    - name: site
      query: "SELECT osm_id AS gid, ST_AsBinary(geometry) AS geom, name, operator
              FROM osm_petroleum_site
              WHERE geometry && !BBOX!"
      geometry: linestring
- name: water
  layers:
    - name: pipeline
      query: "SELECT osm_id AS gid, ST_AsBinary(geometry) AS geom, operator, name, location
              FROM osm_pipeline
              WHERE (substance = 'water' OR type = 'water')
              AND geometry && !BBOX!"
      geometry: linestring
#- name: microwave_hft
#  layers:
#    - name: microwave_link
#      query: "SELECT osm_id AS gid, ST_AsBinary(geometry) AS geom, name AS operator, ref, type,
#              round(ST_Length(ST_Transform(geometry, 4326)::geography)/1000) AS length
#              FROM microwave_link, microwave_operator
#              WHERE microwave_operator.id = microwave_link.operator
#              AND geometry && !BBOX!"
#      geometry: linestring
